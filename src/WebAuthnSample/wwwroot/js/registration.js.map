{"version":3,"file":"js/registration.js","mappings":"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","sources":["webpack://client/./registration/api.ts","webpack://client/./registration/RegistrationForm.tsx","webpack://client/./registration/index.tsx","webpack://client/./shared/FormTextInput.tsx","webpack://client/./shared/conversions.ts"],"sourcesContent":["import { toBase64Url, toArrayBuffer } from \"../shared/conversions\";\r\n\r\n/**\r\n * Retrieves the options for creating a new public key credential on the website.\r\n * @param displayName The display name for the user.\r\n * @param userName  The user name for the user.\r\n * @returns The options to use for creating a new public key credential in the browser using a USB key.\r\n */\r\nexport async function getCredentialCreateOptions(displayName: string, userName: string): Promise<PublicKeyCredentialCreationOptions | undefined> {\r\n    let data = {\r\n        userName,\r\n        displayName\r\n    };\r\n\r\n    try {\r\n        let response = await fetch(\"/api/registration/credentialoptions\", {\r\n            method: \"POST\",\r\n            body: JSON.stringify(data),\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Accept\": \"application/json\"\r\n            }\r\n        });\r\n\r\n        let credentialCreateOptions = await response.json();\r\n\r\n        credentialCreateOptions.user.id = toArrayBuffer(credentialCreateOptions.user.id);\r\n        credentialCreateOptions.challenge = toArrayBuffer(credentialCreateOptions.challenge);\r\n\r\n        credentialCreateOptions.excludeCredentials = credentialCreateOptions.excludeCredentials.map((credential: any) => {\r\n            return {\r\n                ...credential,\r\n                id: toArrayBuffer(credential.id)\r\n            };\r\n        });\r\n\r\n        if (credentialCreateOptions.authenticatorSelection?.authenticatorAttachment === null) {\r\n            credentialCreateOptions.authenticatorSelection.authenticatorAttachment = undefined;\r\n        }\r\n\r\n        return credentialCreateOptions;\r\n    } catch (ex) {\r\n        throw ex;\r\n    }\r\n}\r\n\r\n/**\r\n * Registers the public key credential with the server.\r\n * @param credential The credential to store on the server.\r\n */\r\nexport async function registerPublicKeyCredential(credential: PublicKeyCredential) {\r\n\r\n    let attestationObject = credential.response instanceof AuthenticatorAttestationResponse && credential.response.attestationObject || null;\r\n\r\n    if (attestationObject === null) {\r\n        throw new Error(\"No attestation object found in the public key credential. Please make sure to use \" +\r\n            \"'navigator.credentials.create' to make the public key credential object.\");\r\n    }\r\n\r\n    let data = {\r\n        id: credential.id,\r\n        rawId: toBase64Url(credential.rawId),\r\n        type: credential.type,\r\n        extensions: credential.getClientExtensionResults(),\r\n        response: {\r\n            attestationObject: toBase64Url(attestationObject),\r\n            clientDataJson: toBase64Url(credential.response.clientDataJSON)\r\n        }\r\n    };\r\n    \r\n    let response = await fetch(\"/api/registration/complete\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(data),\r\n        headers: {\r\n            \"Accept\": \"application/json\",\r\n            \"Content-Type\": \"application/json\"\r\n        }\r\n    });\r\n    \r\n    if(response.status != 202) {\r\n        throw new Error(\"Failed to register the credential with the server\");\r\n    }\r\n}","import React, {useState} from \"react\";\r\nimport FormTextInput from \"../shared/FormTextInput\";\r\nimport {getCredentialCreateOptions, registerPublicKeyCredential} from \"./api\";\r\n\r\n/**\r\n * Component used to render the registration form.\r\n */\r\nexport default function RegistrationForm(): React.ReactElement {\r\n    const [userName, setUserName] = useState(\"\");\r\n    const [displayName, setDisplayName] = useState(\"\");\r\n\r\n    async function startRegistration() {\r\n        console.log(\"Registration started\");\r\n\r\n        let credentialCreateOptions = await getCredentialCreateOptions(displayName, userName);\r\n\r\n        let credential = await navigator.credentials.create({\r\n            publicKey: credentialCreateOptions\r\n        });\r\n\r\n        if (credential !== null && credential instanceof PublicKeyCredential) {\r\n            await registerPublicKeyCredential(credential);\r\n        } else {\r\n            throw new Error(\"Failed to register public key credential. Received no credential object that is usable.\");\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    return (\r\n        <form>\r\n            <FormTextInput label=\"Full Name\" identifier=\"fullName\" setValue={setDisplayName} value={displayName}/>\r\n            <FormTextInput label=\"Email Address\" identifier=\"userName\" setValue={setUserName} value={userName}/>\r\n            <button type=\"button\" onClick={startRegistration} className=\"btn btn-primary\">Register</button>\r\n        </form>\r\n    );\r\n}","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport RegistrationForm from \"./RegistrationForm\";\r\n\r\nconst root = ReactDOM.createRoot(document.getElementById(\"registration-form\"));\r\nroot.render(<RegistrationForm/>);\r\n","import React from \"react\";\r\n\r\ninterface FormTextInputProps {\r\n  label: string;\r\n  identifier: string;\r\n  setValue: (value: string) => void;\r\n  value: string;\r\n}\r\n\r\nexport default function FormTextInput({\r\n  label,\r\n  identifier,\r\n  setValue,\r\n  value,\r\n}: FormTextInputProps): React.ReactElement {\r\n  return (\r\n    <div className=\"mb-3\">\r\n      <label htmlFor={identifier} className=\"form-label\">\r\n        {label}\r\n      </label>\r\n      <input type=\"text\" id={identifier} className=\"form-control\" onChange={(args) => setValue(args.target.value)} value={value}></input>\r\n    </div>\r\n  );\r\n}\r\n","export type BufferLike = string | Array<number> | Uint8Array | ArrayBuffer;\r\n\r\n/**\r\n * Converts an array-like object to an array buffer.\r\n * @param data  The input data to convert.\r\n * @returns The converted output.\r\n */\r\nexport function toArrayBuffer(data: BufferLike): ArrayBuffer {\r\n    if (typeof data === \"string\") {\r\n        data = data.replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n\r\n        let str = window.atob(data);\r\n        let bytes = new Uint8Array(str.length);\r\n\r\n        for (let i = 0; i < str.length; i++) {\r\n            bytes[i] = str.charCodeAt(i);\r\n        }\r\n\r\n        return bytes;\r\n    }\r\n\r\n    if (Array.isArray(data)) {\r\n        return new Uint8Array(data);\r\n    }\r\n\r\n    if (data instanceof Uint8Array) {\r\n        return data.buffer;\r\n    }\r\n\r\n    return data;\r\n}\r\n\r\n/**\r\n * Converts an array-like object to a base64 URL-encoded string.\r\n * @param data The input data to convert.\r\n * @returns The URL-encoded base64 string.\r\n */\r\nexport function toBase64Url(data: Uint8Array | ArrayBuffer): string {\r\n    if (data instanceof ArrayBuffer) {\r\n        data = new Uint8Array(data);\r\n    }\r\n\r\n    if (data instanceof Uint8Array) {\r\n        let str = \"\";\r\n        let length = data.byteLength;\r\n\r\n        for (let i = 0; i < length; i++) {\r\n            str += String.fromCharCode(data[i]);\r\n        }\r\n\r\n        return window.btoa(str).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=*$/g, \"\");\r\n    }\r\n\r\n    throw new Error(`Invalid input data: ${data}`);\r\n}"],"names":["getCredentialCreateOptions","displayName","userName","data","fetch","method","body","JSON","stringify","headers","response","json","credentialCreateOptions","user","id","toArrayBuffer","challenge","excludeCredentials","map","credential","authenticatorSelection","authenticatorAttachment","undefined","registerPublicKeyCredential","attestationObject","AuthenticatorAttestationResponse","Error","rawId","toBase64Url","type","extensions","getClientExtensionResults","clientDataJson","clientDataJSON","status","i","RegistrationForm","useState","setUserName","setDisplayName","console","log","navigator","credentials","create","publicKey","PublicKeyCredential","FormTextInput","label","identifier","setValue","value","onClick","className","ReactDOM","document","getElementById","render","htmlFor","onChange","args","target","replace","str","window","atob","bytes","Uint8Array","length","charCodeAt","Array","isArray","buffer","ArrayBuffer","byteLength","String","fromCharCode","btoa"],"sourceRoot":""}